#!/usr/bin/env python3

import json
from os import listdir
from os.path import isfile, join
from pathlib import Path
import datetime

import click

dic_path = Path.home() / 'dic_lookups'
delete_last_line = "\033[1A[\033[2K"

@click.group()
def tango():
    pass

@tango.command()
@click.argument('language')
@click.argument('headword')
@click.option('--add-data', prompt="Add additional data?", default=False)
def add(language, headword, add_data):
    entry = {}
    entry['headword'] = headword
    entry['created'] = datetime.datetime.now(datetime.timezone.utc).strftime("%a %b %d %H:%M:%S %Z %Y")

    if add_data:
        entry['definition'] = click.prompt("Enter definition")
        entry['example'] = click.prompt("Enter example sentence")
        entry['image_url'] = click.prompt("Enter image URL")

    output_file = dic_path / (language + '.txt')
    with open(output_file, 'a') as f:
        print(json.dumps(entry), file=f)

@tango.command()
@click.argument('language')
def study(language):
    """Review the tango for the selected language. If 'all', review all tango for all languages"""
    if language == 'all':
        dic_files = [dic_path / f for f in listdir(dic_path) if isfile(dic_path / f)]
    else:
        dic_files = [join(dic_path, language + '.txt')]
    for file in dic_files:
        with open(file) as f:
            for line in f:
                entry = json.loads(line.strip())
                click.echo(entry['headword'])
                input(">> press enter to go to next word")
                print(delete_last_line)

if __name__ == '__main__':
    tango()
